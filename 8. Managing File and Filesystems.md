# Linux File System
* Hệ thống tệp (file) Linux là một tập hợp có cấu trúc các tệp trên ổ đĩa hoặc một phân vùng. Phân vùng là một phân đoạn bộ nhớ và chứa một số dữ liệu cụ thể. Trong máy của chúng ta, có thể có nhiều phân vùng bộ nhớ khác nhau. Nói chung, mọi phân vùng đều chứa một hệ thống tệp.
* Hệ thống máy tính đa năng cần lưu trữ dữ liệu một cách có hệ thống để chúng ta có thể dễ dàng truy cập các tệp trong thời gian ngắn hơn. Nó lưu trữ dữ liệu trên đĩa cứng (HDD) hoặc một số loại lưu trữ tương đương. Có thể có những lý do dưới đây để duy trì hệ thống tệp:

    * Chủ yếu máy tính lưu dữ liệu vào bộ nhớ RAM; nó có thể mất dữ liệu nếu nó bị tắt. Tuy nhiên, có sẵn RAM bất biến (RAM Flash và SSD) để duy trì dữ liệu sau khi ngắt nguồn.

    * Việc lưu trữ dữ liệu được ưu tiên trên ổ cứng so với RAM tiêu chuẩn vì RAM tốn nhiều dung lượng hơn dung lượng đĩa. Chi phí đĩa cứng đang giảm dần so với RAM.
* Hệ thống tệp Linux chứa các phần sau:

    * Thư mục gốc (/)

    * Định dạng lưu trữ dữ liệu cụ thể (EXT3, EXT4, BTRFS, XFS, v.v.)

    * Một phân vùng hoặc ổ đĩa hợp lý có một hệ thống tệp cụ thể.
## Cấu trúc hệ thống tệp Linux
* Hệ thống tệp Linux có cấu trúc tệp phân cấp vì nó chứa thư mục gốc và các thư mục con của nó.ất cả các thư mục khác có thể được truy cập từ thư mục gốc. Một phân vùng thường chỉ có một hệ thống tệp, nhưng nó có thể có nhiều hơn một hệ thống tệp.

*  Hệ thống tệp được thiết kế theo cách để nó có thể quản lý và cung cấp không gian cho dữ liệu lưu trữ không thay đổi. Tất cả các hệ thống tệp đều yêu cầu một không gian tên là phương pháp đặt tên và tổ chức. Không gian tên xác định quy trình đặt tên, độ dài của tên tệp hoặc một tập hợp con các ký tự có thể được sử dụng cho tên tệp. Nó cũng xác định cấu trúc logic của các tệp trên một phân đoạn bộ nhớ, chẳng hạn như việc sử dụng các thư mục để tổ chức các tệp cụ thể. Khi không gian tên được mô tả, mô tả Siêu dữ liệu phải được xác định cho tệp cụ thể đó.

* Cấu trúc dữ liệu cần hỗ trợ cấu trúc thư mục phân cấp; cấu trúc này được sử dụng để mô tả không gian đĩa có sẵn và được sử dụng cho một khối cụ thể. Nó cũng có các chi tiết khác về tệp như kích thước tệp, ngày và giờ tạo, cập nhật và sửa đổi lần cuối.
* Ngoài ra, nó lưu trữ thông tin nâng cao về phần của đĩa, chẳng hạn như phân vùng và ổ đĩa.

* Dữ liệu nâng cao và cấu trúc mà nó đại diện chứa thông tin về hệ thống tệp được lưu trữ trên ổ đĩa; nó khác biệt và độc lập với siêu dữ liệu hệ thống tệp.

* Hệ thống tệp Linux chứa kiến ​​trúc triển khai phần mềm hệ thống tệp gồm hai phần. Hãy xem xét hình ảnh dưới đây:

![image](https://user-images.githubusercontent.com/91528234/199150030-927ce7b2-c770-48e8-86f5-70b0e92f6eeb.png)

* Hệ thống tệp yêu cầu một API (Giao diện lập trình ứng dụng) để truy cập các lệnh gọi hàm để tương tác với các thành phần của hệ thống tệp như tệp và thư mục. API hỗ trợ các tác vụ như tạo, xóa và sao chép tệp. Nó tạo điều kiện cho một thuật toán xác định sự sắp xếp của các tệp trên một hệ thống tệp.

* Hai phần đầu tiên của hệ thống tệp nhất định được gọi là hệ thống tệp ảo Linux. Nó cung cấp một bộ lệnh duy nhất để hạt nhân và các nhà phát triển truy cập vào hệ thống tệp. Hệ thống tệp ảo này yêu cầu trình điều khiển hệ thống cụ thể cung cấp giao diện cho hệ thống tệp.
## Các tính năng của hệ thống tệp Linux
* Trong Linux, hệ thống tệp tạo ra một cấu trúc cây. Tất cả các tệp được sắp xếp như một cái cây và các nhánh của nó. Thư mục trên cùng được gọi là thư mục gốc (/). Tất cả các thư mục khác trong Linux có thể được truy cập từ thư mục gốc.

* Một số tính năng chính của hệ thống tệp Linux như sau:

    * **Chỉ định đường dẫn**: Sử dụng dấu gạch chéo (/) để chia các thành phần. Dữ liệu sẽ được lưu trữ trong /home/MyDocument/Work.

    * **Phân vùng, Thư mục và Ổ đĩa**: Linux không sử dụng ký tự ổ đĩa để tổ chức ổ đĩa như Windows. Trong Linux,  không thể biết liệu chúng đang định địa chỉ một phân vùng, một thiết bị mạng hay một thư mục "thông thường" và một Ổ đĩa.

    * **Phân biệt chữ hoa chữ thường**: Hệ thống tệp Linux phân biệt chữ hoa chữ thường. Nó phân biệt giữa tên tệp viết thường và viết hoa. Chẳng hạn, có sự khác biệt giữa test.txt và Test.txt trong Linux. Quy tắc này cũng được áp dụng cho các thư mục và lệnh Linux.

    * **Phần mở rộng tệp**: Trong Linux, tệp có thể có phần mở rộng là '.txt', nhưng không nhất thiết tệp phải có phần mở rộng tệp. Trong khi làm việc với Shell, nó tạo ra một số vấn đề cho người mới bắt đầu để phân biệt giữa các tệp và thư mục. Nếu chúng ta sử dụng trình quản lý tệp đồ họa, nó tượng trưng cho các tệp và thư mục.

    * **Tệp ẩn**: Linux phân biệt giữa tệp tiêu chuẩn và tệp ẩn, hầu hết các tệp cấu hình được ẩn trong Hệ điều hành Linux. Thông thường, chúng ta không cần truy cập hoặc đọc các tệp ẩn. Các tệp ẩn trong Linux được biểu thị bằng dấu chấm (.) Trước tên tệp (ví dụ: .ignore). Để truy cập các tệp, chúng ta cần thay đổi chế độ xem trong trình quản lý tệp hoặc cần sử dụng một lệnh cụ thể trong trình bao.
 ## Các loại hệ thống tệp Linux
 * Khi chúng ta cài đặt hệ điều hành Linux, Linux cung cấp nhiều hệ thống tệp như Ext, Ext2, Ext3, Ext4, JFS, ReiserFS, XFS, btrfs và swap.
 ![image](https://user-images.githubusercontent.com/91528234/199150947-0ed029a9-49bb-4fbd-b38b-541b2e71dd5f.png)
 ### Ext, Ext2, Ext3 and Ext4 file system
 * Hệ thống tập tin Ext là viết tắt của **Extended File System**. Nó chủ yếu được phát triển cho **MINIX OS**. Hệ thống tệp Ext là phiên bản cũ hơn và không còn được sử dụng do một số hạn chế.

* **Ext2** là hệ thống tệp Linux đầu tiên cho phép quản lý hai terabyte dữ liệu. Ext3 được phát triển thông qua Ext2; nó là phiên bản nâng cấp của Ext2 và có khả năng tương thích ngược. Hạn chế lớn của Ext3 là không hỗ trợ máy chủ vì hệ thống tệp này không hỗ trợ khôi phục tệp và ảnh chụp nhanh đĩa.

* Hệ thống tệp **Ext4** là hệ thống tệp nhanh hơn trong số tất cả các hệ thống tệp Ext. Đây là một tùy chọn rất tương thích cho các đĩa SSD (ổ thể rắn) và nó là hệ thống tệp mặc định trong bản phân phối Linux.
### JFS File System
* **JFS** là viết tắt của **Journaled File System**, và nó được **IBM phát triển cho AIX Unix**. Nó là một thay thế cho hệ thống tệp Ext. Nó cũng có thể được sử dụng thay cho Ext4, nơi cần sự ổn định với ít tài nguyên. Nó là một hệ thống tệp tiện dụng khi sức mạnh của CPU bị hạn chế.

### Hệ thống tệp ReiserFS

**ReiserFS** là một giải pháp thay thế cho hệ thống tệp Ext3. Nó đã được cải thiện hiệu suất và các tính năng nâng cao. Trong thời gian trước đó, ReiserFS được sử dụng làm hệ thống tệp mặc định trong SUSE Linux, nhưng sau đó nó đã thay đổi một số chính sách nên SUSE quay trở lại Ext3. Hệ thống tệp này hỗ trợ động phần mở rộng tệp, nhưng nó có một số hạn chế về hiệu suất.


### Hệ thống tệp XFS

* Hệ thống tệp **XFS** được coi là JFS tốc độ cao, được phát triển để xử lý I/O song song. NASA vẫn đang sử dụng hệ thống tệp này với máy chủ lưu trữ cao (máy chủ 300+ Terabyte).

### Hệ thống tệp Btrfs

* **Btrfs** là viết tắt của hệ thống tệp B cây. Nó được sử dụng để chịu lỗi, sửa chữa hệ thống, quản trị vui vẻ, cấu hình lưu trữ mở rộng và hơn thế nữa. Nó không phải là một phù hợp tốt cho hệ thống sản xuất.

### Hoán đổi hệ thống tệp

Hệ thống tệp hoán đổi được sử dụng để phân trang bộ nhớ trong hệ điều hành Linux trong chế độ ngủ đông của hệ thống. Một hệ thống không bao giờ ở trạng thái ngủ đông bắt buộc phải có không gian hoán đổi bằng với kích thước RAM của nó.

# Lệnh Fsck trong linux (sửa chữa hệ thống tập tin)
* fsck (kiểm tra hệ thống tệp) là một tiện ích dòng lệnh cho phép bạn thực hiện kiểm tra tính nhất quán và sửa chữa tương tác trên một hoặc nhiều hệ thống tệp Linux. Nó sử dụng các chương trình dành riêng cho loại hệ thống tập tin mà nó kiểm tra.
## Cách sử dụng fsck
Lệnh fsck có dạng chung sau:
```
fsck
```
* Chỉ người dùng root hoặc người dùng có quyền sudo có thể xóa bộ đệm.

* Khi không có `FILESYSTEM` nào được cung cấp làm đối số, fsck kiểm tra các thiết bị được liệt kê trong tệp fstab .

* Không bao giờ chạy fsck trên các phân vùng được gắn vì nó có thể làm hỏng hệ thống tệp. Trước khi thử kiểm tra hoặc sửa chữa các hệ thống tập tin luôn `unmount` nó trước.

* Lệnh fsck là một trình bao bọc cho các trình kiểm tra hệ thống tệp Linux khác nhau ( fsck.* ) Và chấp nhận các tùy chọn khác nhau tùy thuộc vào loại hệ thống tệp.

Kiểm tra các trang hướng dẫn để biết thêm thông tin về một trình kiểm tra cụ thể. Ví dụ: để xem các tùy chọn khả dụng cho fsck.ext4 , hãy nhập:
```
man fsck.ext4
```
## Khi nào thì dùng fsck trong Linux
* Có nhiều tình huống khác nhau khi bạn muốn chạy fsck. Dưới đây là một số ví dụ:

* Hệ thống không khởi động được.

* Các tệp trên hệ thống bị hỏng (thường thì bạn có thể thấy lỗi đầu vào/đầu ra).

* Ổ đĩa đính kèm (bao gồm ổ đĩa flash/thẻ SD) không hoạt động như mong đợi.
## Các tùy chọn có sẵn của fsck
* Lệnh Fsck cần được chạy với các đặc quyền của superuser hoặc **root**. Bạn có thể sử dụng nó với các đối số khác nhau. Việc sử dụng chúng tùy thuộc vào trường hợp cụ thể của bạn. Dưới đây, bạn sẽ thấy một số tùy chọn quan trọng hơn:

|COMMAND| ACTION |
| :---- | :---- |
-A | - Được sử dụng để kiểm tra tất cả các hệ thống tập tin. Danh sách được lấy từ / etc / fstab.
-C | - Hiển thị thanh tiến trình.
-l | - Khóa thiết bị để đảm bảo không có chương trình nào khác cố gắng sử dụng phân vùng trong quá trình kiểm tra.
-M | - Không kiểm tra hệ thống tập tin được gắn kết.
-N | - Chỉ hiển thị những gì sẽ được thực hiện - không có thay đổi thực tế nào được thực hiện.
-P | - Nếu bạn muốn kiểm tra song song các hệ thống tập tin, bao gồm cả root.
-R | - Không kiểm tra hệ thống tập tin gốc. Điều này chỉ hữu ích với ‘-A‘.
-r | - Cung cấp số liệu thống kê cho từng thiết bị đang được kiểm tra.
-T | - Không hiển thị tiêu đề.
-t | - Chỉ định riêng các loại hệ thống tệp được kiểm tra. Các loại có thể là danh sách được phân tách bằng dấu phẩy.
-V | - Cung cấp mô tả những gì đang được thực hiện.
## Cách chạy fsck để sửa lỗi hệ thống tệp Linux
* Trường hợp sử dụng đơn giản nhất của lệnh fsck là sửa chữa một hệ thống tệp ext3 hoặc ext4 không root bị hỏng.

* Ngắt kết nối thiết bị:
```
sudo umount /dev/sda1
```
Chạy fsck để sửa chữa hệ thống tập tin:
```
sudo fsck -p /dev/sda1
```
Tùy chọn `-p` yêu cầu fsck tự động sửa chữa mọi sự cố có thể được khắc phục một cách an toàn mà không cần sự can thiệp của người dùng.

Khi hệ thống tập tin được sửa chữa, gắn kết phân vùng:
```
sudo mount /dev/sda1
```
# Monitoring Disk
## Lệnh df
* Lệnh “df” viết tắt của “disk filesystem“, nó được dùng để lấy toàn bộ thông tin về lượng ổ cứng khả dụng và lượng ổ cứng đã dùng của các file hệ thống trên linux. Cách đơn giản nhất để kiểm tra dung lượng đĩa là ta sử dụng lệnh `df`:

![image](https://user-images.githubusercontent.com/91528234/199157000-dbc89421-d653-4972-9431-1500436c6898.png)

* Trong đó:

   * filesystem: tên filesystem có thể trùng với phân vùng đĩa.
   * 1K-blocks: Số lượng khối (block) có trong filesystem có kích thước 1Kb.
   * Used: Số lượng 1K-block được sử dụng trong filesystem.
   * Available: Số lượng 1K-block đang có sẵn.
   * Use%: Phần trăm đĩa đã sử dụng trong filesystem.
   * Mounted on: Nơi mount.
* Lệnh `df` được đi kèm với một số tùy chọn để hiển thị nội dung rõ ràng và thân thiện với người dùng hơn.
Tùy chọn `-h` cho ta một cái nhìn trực quan hơn khi đọc các thông số ở chế độ chi tiết : bytes, megabytes và gigabytes.

![image](https://user-images.githubusercontent.com/91528234/199157332-6daa82b5-b3ef-4f01-8993-e8cba2c45b42.png)
## Kiểm tra dung lượng đĩa với các trường hợp cụ thể
* Để kiểm tra space của một đĩa/phân vùng cụ thể, bạn sử dụng lệnh df với cú pháp:
```
df <option> path
```
* Một số ví dụ:
     * Kiểm tra dung lượng ổ đĩa phân vùng
     ![image](https://user-images.githubusercontent.com/91528234/199157667-92a505ad-f319-445a-abce-472026e42db6.png)
* Bạn có thể cờ `output` đi kèm lệnh df:
```
df -h --output='field1', 'field2' /
```
      Kiểm tra kích thước và phần trăm đĩa đã sử dụng, ta gõ lệnh:
      ![image](https://user-images.githubusercontent.com/91528234/199157947-dd02236c-d3c5-4e2f-919f-cf5f735ac495.png)
## Lệnh du
* du là một công cụ dòng lệnh được cung cấp bởi Linux, nhằm báo cáo dung lượng ổ đĩa được sử dụng bởi các thư mục và **file.du** là viết tắt của từ “disk usage”. Đây là công cụ chính để phân tích không gian ổ đĩa trong dòng lệnh.
```
du <option> <path|file>
du <option> <path1> <path2> <path3>  
```
* Kiểm tra dung lượng của một file cụ thể
Ví dụ để kiểm tra kích thước của một file .bashrc, bạn có thể chạy lệnh:
![image](https://user-images.githubusercontent.com/91528234/199158729-4e8d56f6-ada1-49a2-8fef-75e0cef44589.png)
## Kiểm tra dung lượng đĩa đã sử dụng cho các thư mục
* Bạn có thể kiểm tra dung lượng đĩa được sử dụng cho thư mục bằng lệnh du với tên đường dẫn cụ thể. Tuy nhiên trong một vài trường hợp bạn không muốn nhìn thấy output của tất cả file hoặc thư mục riêng lẻ, bạn có thể sử dụng tùy chọn `-shc`. Ví dụ dưới đây, tôi muốn kiểm tra dung lượng đĩa đã sử dụng cho thư mục /home hoặc /var/log.
![image](https://user-images.githubusercontent.com/91528234/199159211-4b39670c-9169-463c-8549-bbd019cc67c7.png)
* Ý nghĩa của các tùy chọn:

   * `-s`: dùng để tóm tắt, nó sẽ hiển thị tổng số đường dẫn được cung cấp thay vì hiển thị danh sách tất cả các tệp và thư mục.
   * `-h`: để con người có thể đọc được, nó sẽ hiển thị kết quả với các đơn vị.
   * `-c`: đối với tổng số lớn, nếu bạn chỉ định nhiều đường dẫn, nó sẽ tổng hợp chúng để tạo ra tổng số lớn cho chúng.
   # Tạo file Systems
   
* Lệnh mkfs xây dựng hệ thống tệp trên thiết bị khối:
```
# mkfs [option] device
```
* mkfs là giao diện người dùng cho các tiện ích trình tạo trong /sbin chẳng hạn như **mkfs.ext4**. Bạn có thể sử dụng lệnh mkfs với tùy chọn `-t` fstype hoặc tiện ích trình tạo để chỉ định loại hệ thống tệp cần xây dựng. Ví dụ: các lệnh sau là các cách tương đương để tạo hệ thống tệp ext4 với nhãn Dự án trên thiết bị /dev/sdb1:
```
# mkfs -t ext4 -L Projects /dev/sdb1
# mkfs.ext4 -L Projects /dev/sdb1
```
* và xem file đã được khởi tạo chưa với lệnh
```
lsblk
```
# Mounting and Unmounting Filesystems
* Để truy cập nội dung của hệ thống tệp, bạn phải gắn thiết bị khối của nó vào một điểm gắn kết trong hệ thống phân cấp thư mục. Bạn có thể sử dụng lệnh mkdir để tạo một thư mục để sử dụng làm điểm gắn kết, ví dụ:
```
# mkdir /var/project
```

* Bạn có thể sử dụng một thư mục hiện có làm điểm gắn kết, nhưng nội dung của nó sẽ bị ẩn cho đến khi bạn ngắt kết nối hệ thống tệp cơ bản.

* Lệnh mount sẽ gắn thiết bị chứa hệ thống tệp vào điểm mount:
```
# mount [options] device mount_point 
```

* Bạn có thể chỉ định thiết bị theo tên, UUID hoặc nhãn của nó. Ví dụ: các lệnh sau là các cách tương đương để gắn hệ thống tệp trên thiết bị khối /dev/sdb1:
```
# mount /dev/sdb1/var/project
# mount LABEL = "projects" /var/project
```

* Nếu bạn không chỉ định bất kỳ đối số nào, mount sẽ hiển thị tất cả các hệ thống tệp mà hệ thống hiện đã gắn kết, ví dụ:
```
# mout
/dev/mapper/vg_host01-lv_root on / type ext4 (rw)
...
```
* Trong ví dụ này, LVM logic volume/dev/mapper/ vg_host01-lv_root được gắn trên /. Loại hệ thống tệp là ext4 và được gắn cho cả việc đọc và ghi. (Bạn cũng có thể sử dụng lệnh cat /proc/mounts để hiển thị thông tin về hệ thống tệp được gắn kết.)

Lệnh df hiển thị thông tin về không gian còn lại trong nhà trên các hệ thống tệp được gắn kết, ví dụ:
